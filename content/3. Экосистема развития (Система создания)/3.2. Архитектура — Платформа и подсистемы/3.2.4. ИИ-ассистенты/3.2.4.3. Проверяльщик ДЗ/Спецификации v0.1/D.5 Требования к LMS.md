# D.5 Требования к LMS

Требования к LMS (Aisystant) для интеграции с ДЗ-чекером v0.1.

---

## Общие требования

### Доступ к функции

| Требование | Описание |
|------------|----------|
| **Тип задания** | Только чеклист/ДЗ |
| **Подписка** | Только пользователи с действующей подпиской БР |
| **Интерфейс** | Кнопка «Проверить с ИИ» |

---

## UI: Кнопка «Проверить с ИИ»

### Расположение

Кнопка располагается рядом с полем комментария к пункту чеклиста/ДЗ.

```
┌────────────────────────────────────────────────────────────┐
│  Пункт 1: Почему физический мир может иметь множество      │
│  описаний?                                                 │
├────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Ваш ответ:                                           │  │
│  │                                                      │  │
│  │ Любая модель части физического мира фокусируется... │  │
│  │                                                      │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                            │
│  [ Сохранить ]   [ Проверить с ИИ ]                       │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### Условия отображения

| Условие | Кнопка |
|---------|--------|
| Пользователь с подпиской БР | Показать |
| Пользователь без подписки БР | Скрыть или показать неактивной с подсказкой |
| Тип задания — чеклист/ДЗ | Показать |
| Другой тип задания | Скрыть |
| Поле ответа пустое | Показать неактивной |

### Состояния кнопки

| Состояние | Вид | Действие при клике |
|-----------|-----|-------------------|
| **Готова** | `[ Проверить с ИИ ]` | Отправить запрос |
| **Загрузка** | `[ ⏳ Проверяю... ]` | Ничего |
| **Неактивна** | `[ Проверить с ИИ ]` (серая) | Показать причину |

---

## UI: Отображение результата

### После получения ответа

Результат отображается под кнопкой в блоке комментария:

```
┌────────────────────────────────────────────────────────────┐
│  Результат ИИ-проверки                                     │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  ✓ Принято (85/100)                    08.09.2025 в 20:35 │
│                                                            │
│  Сильные стороны:                                          │
│  • Верно указано, что любая модель фокусируется на        │
│    определённых свойствах                                  │
│  • Хороший пример с программным продуктом                  │
│                                                            │
│  Замечания:                                                │
│  • Не использован термин «описание системы» —              │
│    рекомендую использовать точную терминологию             │
│                                                            │
│  Следующий шаг:                                            │
│  Попробуйте привести ещё один пример из вашей практики    │
│                                                            │
│  ─────────────────────────────────────────────────────     │
│  Проверено: Claude 3.5 Sonnet                             │
│  По материалам: Глава 1, раздел 1.1                        │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### Формат комментария

Комментарий приходит в Markdown и должен быть отрендерен:
- Жирный текст: `**текст**`
- Списки: `- элемент` или `• элемент`
- Курсив: `_текст_`
- Разделитель: `---`

---

## Ограничения v0.1

### Результат не сохраняется

> **Важно:** В v0.1 результат проверки **нигде не сохраняется** и потеряется при:
> - Обновлении страницы
> - Переходе на другой раздел курса
> - Закрытии вкладки

Необходимо уведомить пользователя об этом.

### Одна проверка за раз

- Проверка выполняется для одного пункта чеклиста
- Пакетная проверка не поддерживается

---

## Интеграция с API

### Формирование запроса

LMS собирает данные из интерфейса:

| Поле API | Источник в LMS |
|----------|----------------|
| `answer_text` | Текст из поля комментария |
| `question_text` | Текст пункта чеклиста |
| `course_name` | Название курса (из навигации) |
| `section_name` | Название раздела (из дерева навигации) |

### Пример запроса

```javascript
const response = await fetch('/api/homework-checker/check', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    answer_text: document.querySelector('.answer-input').value,
    question_text: document.querySelector('.question-text').textContent,
    course_name: getCourseNameFromNavigation(),
    section_name: getSectionNameFromNavigation()
  })
});
```

### Обработка ответа

1. Показать блок результата
2. Отрендерить `comment` как Markdown
3. Показать время проверки из `checked_at`

### Обработка ошибок

| Ошибка | Действие |
|--------|----------|
| Сетевая ошибка | Показать "Не удалось связаться с сервером. Попробуйте позже." |
| HTTP 400 | Показать "Ошибка в запросе. Проверьте текст ответа." |
| HTTP 500 | Показать "Сервис временно недоступен. Попробуйте позже." |
| Таймаут (> 30 сек) | Показать "Проверка занимает больше времени. Попробуйте позже." |

---

## Проверка подписки БР

### Логика

```javascript
function canUseAICheck(user) {
  return user.hasActiveSubscription('BR');
}
```

### Сообщение для пользователей без подписки

> Проверка с ИИ доступна для пользователей с подпиской БР.
> [Узнать о подписке →]

---

## Roadmap интеграции

### v0.1 (текущая)
- Кнопка «Проверить с ИИ»
- Синхронный запрос
- Отображение без сохранения

### v0.2
- Сохранение результатов в БД
- Статусы: «На проверке ИИ», «Проверено ИИ»
- История проверок

### v0.3
- Пакетная проверка всего чеклиста
- Интеграция с наставниками

---

## Связанные документы

- [D.1 Спецификация API ДЗ-чекера](./D.1%20Спецификация%20API%20ДЗ-чекера.md)
- [Общее описание Проверяльщика ДЗ](../Общее%20описание%20Проверяльщика%20ДЗ%20(ДЗ-чекер)%203.2.md) — раздел "Что нужно сделать по каждой системе / LMS"

---

**Версия:** 0.1
**Дата:** 2025-12-23
**Статус:** Для согласования с командой фронтенда
