---
type: doc
status: draft
created: 2026-01-16
layer: methodology
scope: local-edge
audience:
  - "Команда экосистемы"
  - "ИИ-агенты"
  - "Разработчики платформы"
related_documents:
  - "Концепция Генератора инфопродуктов.md"
---

# Концепция Индексатора знаний

## 0. Назначение, аудитория, границы

**Назначение документа:** зафиксировать концепцию Индексатора знаний — системы, которая создаёт и поддерживает Индекс знаний для использования Генератором инфопродуктов и другими системами экосистемы.

**Аудитория:** команда, которая проектирует и реализует Индексатор знаний, хранилища знаний и процессы пополнения информации.

**Границы:** документ описывает назначение, архитектуру подсистем, рабочие продукты (артефакты) и процессы Индексатора знаний. Конкретные технологии реализации не фиксируются (их можно вынести в отдельные спецификации).

**Связь с другими системами:** Индексатор знаний создаёт и поддерживает Индекс знаний, который используется Генератором инфопродуктов для сборки пакета контекста. См. [[Концепция Генератора инфопродуктов.md]].

---

## 1. Контекст и назначение

### 1.1. Проблема

Участники экосистемы создают контент в различных системах (Клуб, LMS, Telegram, личные заметки), который:

* распылён по разным источникам;
* не структурирован для повторного использования;
* не индексирован для быстрого поиска;
* теряется и не переиспользуется при создании новых продуктов.

### 1.2. Идея решения

**Индексатор знаний** превращает разрозненный первичный контент в структурированный Индекс знаний, который:

* собирает контент из разных источников в единое хранилище;
* нормализует контент в чанки с метаданными;
* индексирует чанки для быстрого семантического и лексического поиска;
* синхронизирует изменения в режиме реального времени;
* обеспечивает трассируемость и версионность знаний.

### 1.3. Ключевые принципы

1. **Автоматизация сбора.** Контент собирается автоматически из всех подключённых источников.
2. **Структурированность.** Контент нормализуется в единый формат (чанки с метаданными).
3. **Находимость.** Индекс знаний поддерживает векторный и лексический поиск.
4. **Актуальность.** Индекс синхронизируется при изменении источников.
5. **Трассируемость.** Каждый чанк имеет явную связь с источником и историей изменений.

---

## 2. Место Индексатора знаний в системе

### 2.1. Вход и выход

**Вход:** Первичный контент из различных источников (Клуб, LMS, Telegram, ручные заметки).

**Выход:** Индекс знаний — структурированное хранилище чанков с метаданными и векторными представлениями для быстрого поиска.

### 2.2. Связь с Генератором инфопродуктов

**Индексатор знаний** создаёт **Индекс знаний**, который используется **Генератором инфопродуктов** для:

1. Подбора релевантных чанков при планировании контекста.
2. Извлечения информации для сборки пакета контекста.
3. Формирования ссылок на источники в итоговых инфопродуктах.

**Схема взаимодействия:**

```
Первичный контент (РП-1)
        ↓
   [Индексатор знаний]
        ↓
Индекс знаний (РП-4)
        ↓
   [Генератор инфопродуктов]
        ↓
Инфопродукт (РП-7)
```

См. подробнее: [[Концепция Генератора инфопродуктов.md]]

---

## 3. Рабочие продукты (артефакты) Индексатора знаний

### 3.1. РП-1: Первичный контент

**Что это:** Исходные текстовые материалы, создаваемые участником экосистемы в различных системах.

**Типы:**
- Посты в Клубе
- Комментарии под постами других участников
- Ответы на домашние задания в LMS
- Комментарии к ДЗ других участников
- Личные заметки в Telegram
- Рефлексии
- Проектная документация

**Характеристики:**
- Формат: текст (markdown, plain text, HTML)
- Размер: любой (от нескольких слов до статей)
- Структура: произвольная, зависит от источника
- Версионирование: нет (до попадания в репозиторий)

**Место хранения (до сбора):**
- Клуб (Circle/Discourse)
- LMS
- Telegram
- Другие источники

### 3.2. РП-2: Первичный контент в репозитории

**Что это:** Первичный контент после сбора, но до нормализации.

**Характеристики:**
- Сохраняет исходную структуру источника
- Хранится в Git (версионируется)
- Ещё не разбит на чанки
- Может быть любого размера

**Место хранения:**
- Репозиторий знаний: https://github.com/aisystant/personal-knowledge
- Промежуточная зона `/raw` или `/primary` до обработки

### 3.3. РП-3: Нормализованные чанки

**Что это:** Единицы хранения знаний — markdown-файлы с метаданными.

**Характеристики:**
- **Размер:** до 10 000 знаков основного текста (без истории изменений)
- **Формат:** Markdown с YAML frontmatter
- **ID:** `chunk_YYYYMMDD_NNN` (уникальный идентификатор)
- **Метаданные frontmatter:**
  - `id` — уникальный идентификатор
  - `source` — источник (club/posts, lms/homework, manual/notes и т.д.)
  - `type` — тип контента (post, comment, homework-review, note, reflection и т.д.)
  - `created` — дата создания (ISO8601)
  - `updated` — дата последнего изменения (ISO8601)
  - `author` — автор
  - `tags` — список тегов
  - `word_count` — количество слов
  - `char_count` — количество символов (макс 10000)
  - `related_chunks` — связанные чанки
  - `original_url` — URL источника (если есть)
  - `context` — краткое описание контекста

**Структура файла:**
```markdown
---
id: chunk_20260113_042
source: club/posts
type: post
created: 2026-01-13T10:30:00Z
updated: 2026-01-13T10:30:00Z
author: Участник
tags: [системное мышление, архитектура]
word_count: 450
char_count: 2850
related_chunks: [chunk_20260112_015]
original_url: https://club.aisystant.com/posts/12345
context: Размышления об архитектуре хранилищ знаний
---

# Заголовок чанка

Основной текст (до 10 000 знаков)...

---
<!-- EMBEDDINGS_EXCLUDE_START -->
## История изменений

### 2026-01-13 10:30 - Создание
- Импортировано из Клуба
<!-- EMBEDDINGS_EXCLUDE_END -->
```

**Место хранения:**
- Репозиторий знаний: https://github.com/aisystant/personal-knowledge
- Структура папок: `club/`, `lms/`, `manual/`, `external/`

**Возможность редактирования:**
- Пользователь может вручную редактировать чанки
- Все изменения фиксируются в секции "История изменений"
- История находится между маркерами `<!-- EMBEDDINGS_EXCLUDE_START -->` и `<!-- EMBEDDINGS_EXCLUDE_END -->`
- История не учитывается при индексации

### 3.4. РП-4: Индекс знаний

**Что это:** Совокупность структур для быстрого поиска релевантных чанков.

**Компоненты:**

1. **Векторный индекс (эмбеддинги):**
   - Векторные представления чанков
   - Размерность: зависит от модели эмбеддингов (например, 1536 для OpenAI ada-002)
   - Связь: chunk_id → вектор
   - Метаданные для фильтрации (tags, source, type, created)

2. **Лексический индекс (опционально):**
   - BM25 или аналог
   - Для точных совпадений ключевых слов

3. **Метаиндекс:**
   - Реестр всех чанков
   - Версия индекса
   - Timestamp последнего обновления

**Характеристики:**
- Обновляется при изменении чанков
- Версионируется (index_version)
- Поддерживает инкрементальное обновление

**Место хранения:**
- Векторное хранилище (Pinecone, Weaviate, Qdrant и т.п.)
- Доступ через MCP-серверы (fsm-mcp, DS-twin)

**Использование:**
- Сборщик контекста Генератора инфопродуктов использует РП-4 для извлечения релевантных чанков
- См. [[Концепция Генератора инфопродуктов.md]], раздел "Сборщик контекста"

---

## 4. Подсистемы Индексатора знаний

### 4.1. Общая схема

```
┌─────────────────────────────────────────────────────────┐
│   ИНДЕКСАТОР ЗНАНИЙ (Knowledge Indexer)                 │
│   ИИ-агент                                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   ┌──────────────┐    ┌──────────────┐                │
│   │  Сборщик     │ →  │ Нормализатор │                │
│   │  (Collector) │    │  (Chunker)   │                │
│   └──────────────┘    └──────────────┘                │
│         ↓                     ↓                         │
│   РП-1 → РП-2            РП-2 → РП-3                   │
│                                                         │
│   ┌──────────────┐    ┌──────────────┐                │
│   │  Индексатор  │    │Синхронизатор │                │
│   │  (Embedder)  │    │ (Watcher)    │                │
│   └──────────────┘    └──────────────┘                │
│         ↓                                               │
│   РП-3 → РП-4                                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2. Подсистема 1: Сборщик (Collector)

**Назначение:** Собрать первичный контент из различных источников.

**Вход:** Первичный контент из различных источников (РП-1).

**Действия:**
- Автоматический сбор из Клуба (API)
- Автоматический сбор из LMS (API)
- Сбор из Telegram (Bot API)
- Ручной импорт пользователем (через интерфейс)
- Фиксация метаданных источника (URL, timestamp, author)

**Выход:** Первичный контент в репозитории (РП-2).

**Технологии:**
- API интеграции с Клубом, LMS, Telegram
- Git для версионирования

### 4.3. Подсистема 2: Нормализатор (Normalizer / Chunker)

**Назначение:** Преобразовать первичный контент в нормализованные чанки с метаданными.

**Вход:** Первичный контент в репозитории (РП-2).

**Действия:**
- **Автоматическое чанкование:**
  - Если контент < 10k знаков → создаёт 1 чанк
  - Если контент > 10k знаков → делит на N чанков
  - Использует семантические границы (параграфы, разделы)
  - Применяет перекрытие (overlap) 10-20% между чанками
- Присвоение уникального ID (`chunk_YYYYMMDD_NNN`)
- Создание YAML frontmatter с метаданными
- Создание секции "История изменений" (`EMBEDDINGS_EXCLUDE`)
- **Ручное чанкование:** пользователь может вручную редактировать границы чанков

**Выход:** Нормализованные чанки (РП-3).

**Стратегия чанкования:**
- Размер: 512-1024 токена (или до 10k знаков)
- Перекрытие: 10-20%
- Семантические границы: параграфы, разделы, смысловые разрывы

**Технологии:**
- NLP-библиотеки для определения границ (например, spaCy)
- Markdown парсеры

### 4.4. Подсистема 3: Индексатор (Embedder / Indexer)

**Назначение:** Создать векторные представления чанков и сохранить в Индекс знаний.

**Вход:** Нормализованные чанки (РП-3).

**Действия:**
- Извлечение текста чанков (игнорируя `EMBEDDINGS_EXCLUDE`)
- Создание векторных представлений (эмбеддингов) через модель эмбеддингов
- Сохранение эмбеддингов в векторное хранилище
- Связывание chunk_id с эмбеддингом
- (Опционально) Создание лексического индекса (BM25)
- Версионирование индекса
- Инкрементальное обновление при изменении чанков

**Выход:** Индекс знаний (РП-4).

**Технологии:**
- Модели эмбеддингов: OpenAI text-embedding-ada-002, Voyage, Cohere и др.
- Векторное хранилище: Pinecone, Weaviate, Qdrant, Chroma
- MCP-серверы для доступа к хранилищам

### 4.5. Подсистема 4: Синхронизатор (Synchronizer / Watcher)

**Назначение:** Отслеживать изменения в чанках и автоматически обновлять Индекс знаний.

**Вход:** Изменения в чанках (Git commits).

**Действия:**
- Отслеживание изменений в репозитории (Git hooks / webhooks)
- Определение изменённых/новых/удалённых чанков
- Запуск переиндексации для изменённых чанков
- Удаление эмбеддингов для удалённых чанков
- Обновление версии индекса
- Обновление метаиндекса

**Выход:** Актуальный индекс знаний (РП-4).

**Технологии:**
- Git hooks (pre-commit, post-commit)
- Webhooks (GitHub, GitLab)
- Системы очередей (для асинхронной обработки)

---

## 5. Хранилища данных

### 5.1. Репозиторий знаний (Knowledge Repository)

**Тип:** Git-репозиторий (GitHub)
**URL:** https://github.com/aisystant/personal-knowledge

**Содержит:**
- Первичный контент (после сбора): `/raw` или `/primary`
- Нормализованные чанки: `/club`, `/lms`, `/manual`, `/external`
- Metadata (метаданные)

**Структура:**
```
knowledge-repository/
├── raw/                   # РП-2: Первичный контент
│   ├── club/
│   ├── lms/
│   └── telegram/
├── club/                  # РП-3: Нормализованные чанки из Клуба
│   ├── posts/
│   └── comments/
├── lms/                   # РП-3: Нормализованные чанки из LMS
│   ├── homework-reviews/
│   └── my-homework/
├── manual/                # РП-3: Ручные добавления
│   ├── notes/
│   ├── reflections/
│   └── projects/
├── external/              # РП-3: Импорт из других репо
└── metadata/              # Метаданные
    ├── index_version.json
    └── stats.json
```

**Версионирование:** Git (полная история изменений).

### 5.2. База эмбеддингов (Vector Store)

**Тип:** Векторное хранилище
**Технологии:** Pinecone, Weaviate, Qdrant, Chroma

**Содержит:**
- Векторные представления чанков (эмбеддинги)
- Метаданные для фильтрации (tags, source, type, created)
- Версия индекса

**Доступ:**
- Через MCP-серверы: fsm-mcp, DS-twin
- API векторного хранилища

**Операции:**
- Векторный поиск (similarity search)
- Фильтрация по метаданным
- Инкрементальное обновление
- Удаление устаревших эмбеддингов

### 5.3. Лексический индекс (Text Index) — опционально

**Тип:** Поисковая система
**Технологии:** Elasticsearch, custom BM25

**Содержит:**
- Инвертированный индекс терминов
- TF-IDF статистики
- Связь с chunk_id

**Назначение:**
- Точный поиск по ключевым словам
- Гибридное извлечение (вместе с векторным поиском) для Генератора инфопродуктов

---

## 6. Процесс индексации

### 6.1. Триггеры процесса

**Автоматические:**
- Новый контент в источниках (Клуб, LMS, Telegram)
- Изменение существующих чанков (Git commit)
- По расписанию (каждые N часов)

**Ручные:**
- Ручной импорт пользователем через интерфейс
- Принудительная переиндексация (при изменении модели эмбеддингов)

### 6.2. Шаги процесса

**1. Сбор** (Сборщик)
   - Автоматический: API Клуба/LMS/Telegram
   - Ручной: UI для импорта
   - Сохранение в репозиторий знаний → РП-2

**2. Нормализация** (Нормализатор)
   - Автоматическое чанкование
   - Присвоение ID и метаданных
   - Сохранение чанков → РП-3

**3. Индексация** (Индексатор)
   - Извлечение текста чанков
   - Создание эмбеддингов
   - Сохранение в векторное хранилище → РП-4

**4. Синхронизация** (Синхронизатор)
   - Отслеживание изменений
   - Переиндексация изменённых чанков
   - Обновление версии индекса

### 6.3. Частота выполнения

- **Автоматический сбор:** каждые N часов (настраиваемо)
- **Синхронизация:** при каждом Git push
- **Ручной импорт:** по запросу пользователя

### 6.4. Время выполнения

- Сбор: несколько секунд до минут (зависит от объёма)
- Нормализация: несколько секунд на документ
- Индексация: несколько секунд на чанк
- Полная переиндексация: часы (зависит от размера репозитория)

---

## 7. Требования к качеству

### 7.1. Индекс знаний

Индекс знаний считается качественным, если:

- ✅ **Синхронизирован:** отражает последние изменения в репозитории (не старше N часов)
- ✅ **Версионирован:** есть `index_version` и timestamp
- ✅ **Полон:** все чанки из репозитория проиндексированы
- ✅ **Консистентен:** chunk_id в индексе соответствует chunk_id в репозитории
- ✅ **Находим:** векторный поиск возвращает релевантные результаты

### 7.2. Нормализованные чанки

Чанки считаются корректными, если:

- ✅ **Размер:** до 10k знаков основного текста
- ✅ **Метаданные:** все обязательные поля заполнены
- ✅ **ID:** уникальный и следует формату `chunk_YYYYMMDD_NNN`
- ✅ **Трассируемость:** есть связь с источником (original_url)
- ✅ **История:** изменения фиксируются в секции EMBEDDINGS_EXCLUDE

### 7.3. Процесс индексации

Процесс считается корректным, если:

- ✅ **Автоматизирован:** работает без вмешательства человека
- ✅ **Надёжен:** обрабатывает ошибки и восстанавливается
- ✅ **Быстр:** индексирует новые чанки в течение N минут
- ✅ **Мониторим:** есть логи и метрики процесса

---

## 8. Минимальный SoTA-апгрейд (рекомендуемый)

Чтобы качество Индексатора было ближе к state-of-the-art practice, рекомендуется:

### 8.1. Гибридная индексация (обязательно)

- ✅ **Векторный индекс:** для семантического поиска
- ✅ **Лексический индекс (BM25):** для точных совпадений ключевых слов
- ✅ Генератор инфопродуктов сможет использовать гибридное извлечение

### 8.2. Стратегия чанкования (обязательно)

- ✅ **Фиксированная политика:**
  - Размер: 512-1024 токена (или до 10k знаков)
  - Перекрытие (overlap): 10-20%
  - Семантические границы: параграфы, разделы
- ✅ Документирование выбранной стратегии

### 8.3. Продвинутые методы (опционально)

- ⚪ **Метаданные для фильтрации:** tags, source, type, date range
- ⚪ **Иерархическая индексация:** summary chunks + detail chunks
- ⚪ **Контекстные эмбеддинги:** учёт окружающих чанков при векторизации
- ⚪ **Observability:** логирование всех этапов (сбор → нормализация → индексация)

---

## 9. Минимальная дорожная карта

### Этап 1: Базовый цикл (ручной импорт)

- Ручной импорт контента
- Нормализация в чанки
- Векторная индексация
- Простой поиск

### Этап 2: Автоматизация сбора

- API интеграции с Клубом
- API интеграции с LMS
- Telegram bot для заметок
- Автоматический сбор по расписанию

### Этап 3: Синхронизация и обновления

- Git hooks для отслеживания изменений
- Инкрементальное обновление индекса
- Версионирование индекса

### Этап 4: Гибридная индексация

- Лексический индекс (BM25)
- Гибридное извлечение (векторный + лексический)
- Переранжирование результатов

### Этап 5: Продвинутые возможности

- Иерархическая индексация
- Метаданные для фильтрации
- Observability и мониторинг
- Автоматическая оптимизация стратегии чанкования

---

## 10. Связанные документы

- [[Концепция Генератора инфопродуктов.md]] — система, использующая Индекс знаний для создания инфопродуктов
- [[Репозиторий знаний - структура и задание]] — детальное описание структуры репозитория
- [[3.2.6. Хранилища данных/README]] — обзор всех хранилищ экосистемы
- [[Структура хранилища 0.1]] — структура текущего хранилища DS-ecosystem-development

---

## 11. История изменений

### 2026-01-16 — Создание v0.1
- Выделено из "Описание процесса создания продуктов из знаний"
- Сфокусировано на Индексаторе знаний
- Убраны детали Генератора инфопродуктов (вынесены в отдельный документ)
- Добавлены связи между документами
- Добавлена дорожная карта развития

---

**Статус:** Draft
**Версия:** 0.1
**Дата создания:** 2026-01-16
**Целевая аудитория:** Команда экосистемы, разработчики платформы, ИИ-агенты
