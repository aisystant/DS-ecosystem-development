---
type: doc
status: draft
created: 2026-02-01
layer: methodology
scope: core-infrastructure
audience:
  - "Команда экосистемы"
  - "Разработчики платформы"
  - "Методологи"
related_documents:
  - "C2.2.Architecture/3.2.3.1. Цифровой двойник/Модель данных цифрового двойника 3.2.md"
  - "C2.2.Architecture/3.2.3.1. Цифровой двойник/MCP-сервер цифрового двойника 3.2.md"
  - "Концепция Проводника по персональному маршруту.md"
---

# Мета-модель цифрового двойника

> **Версия:** 0.2 (согласовано с существующей моделью данных)

## 0. Назначение, аудитория, границы

**Назначение документа:** описать мета-модель цифрового двойника (`PRS.Twin`) — структуру описания показателей, архитектуру хранения и MCP-инструменты для работы с ней.

**Аудитория:**
- Разработчики платформы и MCP-серверов
- Методологи, проектирующие модель созидателя
- ИИ-агенты (`AGT.RouteGuide` и другие), работающие с данными участника

**Границы:**
- Документ описывает **мета-модель** (схему данных) — какие показатели существуют, их типы, форматы, пороги
- Фактические **данные** участников хранятся в отдельном хранилище
- Документ дополняет [[Модель данных цифрового двойника 3.2]], добавляя уровень мета-описаний

**Согласование с репозиторием:**
- Нотация показателей: `IND.1.*` (первичные), `IND.2.*` (производные) — согласно существующей модели
- Терминология: `PRS.Twin`, `STG.Student.*`, `AGT.RouteGuide` — согласно существующим документам
- Ступени Ученика: Случайный → Практикующий → Систематический → Дисциплинированный → Проактивный

---

## 1. Два уровня данных

### 1.1. Мета-модель vs Данные

| Уровень | Что хранит | Где хранится | Частота изменений |
|---------|------------|--------------|-------------------|
| **Мета-модель (schema)** | Описание показателей: тип, формат, пороги, связи | Репозиторий (markdown + JSON) | Редко (при изменении методологии) |
| **Данные (values)** | Значения показателей для конкретного человека | БД (SurrealDB/PostgreSQL) | Часто (ежедневно/еженедельно) |

```
Мета-модель (schema)              →    Данные (values)
────────────────────────────────────────────────────────
IND.2.1.1: float, часы/неделю     →    3.5 (для user_123)
IND.2.4.2: enum[5 ступеней]       →    "Систематический"
IND.1.5.1: list[pomodoro]         →    [{date, duration}, ...]
```

### 1.2. Зачем нужна мета-модель?

**Проблема:** Существующая [[Модель данных цифрового двойника 3.2]] описывает *какие* показатели есть, но не описывает:
- Машиночитаемые форматы для валидации
- Пороги по ступеням для автоматической квалификации
- Связи между показателями
- Правила использования в промптах

**Решение:** Мета-модель добавляет слой описаний поверх модели данных:

```
┌─────────────────────────────────────────────────────────────┐
│  Мета-модель (этот документ)                                │
│  - Описания показателей в markdown                          │
│  - Машиночитаемый реестр (registry.json)                    │
│  - Пороги, форматы, связи                                   │
├─────────────────────────────────────────────────────────────┤
│  Модель данных (существующий документ)                      │
│  - Список первичных данных (IND.1.*)                        │
│  - Список производных показателей (IND.2.*)                 │
├─────────────────────────────────────────────────────────────┤
│  Данные участников                                          │
│  - Конкретные значения в БД                                 │
│  - История изменений                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. Гибридная архитектура хранения

### 2.1. Принцип: мета-модель в репозитории, данные в БД

```
ecosystem-development/                    ← Мета-модель (версионируется)
└── 0.OPS/0.x.Metamodel/
    ├── indicators/
    │   ├── IND.2.1.1.md                 # Описание показателя
    │   ├── IND.2.1.2.md
    │   └── ...
    ├── groups/
    │   ├── agency.md                    # Описание группы 2.1.*
    │   ├── mastery.md                   # Описание группы 2.2.*
    │   └── ...
    └── registry.json                    # Машиночитаемый реестр

digital-twin-storage/                     ← Данные (отдельная БД)
└── SurrealDB / PostgreSQL
    ├── persons/{user_id}/               # Данные по человеку
    │   ├── IND.2.1.1: 3.5
    │   ├── IND.2.4.2: "Систематический"
    │   └── ...
    └── history/                         # История изменений
```

### 2.2. Преимущества гибридной архитектуры

| Аспект | Мета-модель в репо | Данные в БД |
|--------|-------------------|-------------|
| **Версионирование** | Git history, PR review | Не нужно для каждого значения |
| **Редактирование** | Методологи через markdown | API/MCP для ИИ и систем |
| **Валидация** | CI/CD проверки схемы | Валидация по схеме из репо |
| **Доступ** | Публичный (open source) | Приватный (персональные данные) |

### 2.3. Один MCP-сервер с двумя группами tools

```
┌─────────────────────────────────────────────────────────────┐
│           MCP-сервер цифрового двойника                     │
│           (расширение существующего сервера)                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────┐    ┌─────────────────────┐        │
│  │   Группа META       │    │   Группа DATA       │        │
│  │   (мета-модель)     │    │   (данные)          │        │
│  ├─────────────────────┤    ├─────────────────────┤        │
│  │ describe_indicator  │    │ get_learner_summary │        │
│  │ list_indicators     │    │ get_learner_metrics │        │
│  │ get_thresholds      │    │ upsert_stage_eval   │        │
│  │ validate_value      │    │ read_indicator      │        │
│  │                     │    │ write_indicator     │        │
│  └──────────┬──────────┘    └──────────┬──────────┘        │
│             │                          │                    │
│             ▼                          ▼                    │
│  ┌─────────────────────┐    ┌─────────────────────┐        │
│  │   Репозиторий       │    │   База данных       │        │
│  │   (markdown/JSON)   │    │   (SurrealDB)       │        │
│  └─────────────────────┘    └─────────────────────┘        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. Структура мета-модели в репозитории

### 3.1. Организация файлов

```
0.OPS/0.x.Metamodel/
├── README.md                           # Обзор мета-модели
│
├── indicators/                         # Описания показателей
│   ├── primary/                        # IND.1.* — первичные данные
│   │   ├── IND.1.1.1.md               # Профиль пользователя LMS
│   │   ├── IND.1.3.4.md               # Учебные сессии
│   │   ├── IND.1.5.1.md               # Помидорки
│   │   └── ...
│   │
│   └── derived/                        # IND.2.* — производные
│       ├── IND.2.1.1.md               # Часы в неделю
│       ├── IND.2.1.2.md               # Доля дней со слотом
│       ├── IND.2.4.2.md               # Ступень Ученика
│       └── ...
│
├── groups/                             # Описания групп показателей
│   ├── 2.1-agency.md                  # Агентность и учебный ритм
│   ├── 2.2-mastery.md                 # Степень мастерства
│   ├── 2.3-characteristics.md         # Характеристики по ступеням
│   ├── 2.4-qualification.md           # Квалификация
│   ├── 2.5-roles.md                   # Мастерство по ролям
│   ├── 2.6-resourcefulness.md         # Ресурсность
│   └── ...
│
├── thresholds/                         # Пороги по ступеням
│   ├── STG.Student.Random.md          # Случайный
│   ├── STG.Student.Practicing.md      # Практикующий
│   ├── STG.Student.Systematic.md      # Систематический
│   ├── STG.Student.Disciplined.md     # Дисциплинированный
│   └── STG.Student.Proactive.md       # Проактивный
│
└── registry.json                       # Машиночитаемый реестр
```

### 3.2. Формат описания показателя

Файл `indicators/derived/IND.2.1.1.md`:

```markdown
# IND.2.1.1 — Среднее число часов саморазвития в неделю

## Мета-данные

| Свойство | Значение |
|----------|----------|
| **Код** | IND.2.1.1 |
| **Название** | Среднее число часов саморазвития в неделю |
| **Группа** | 2.1 Агентность и учебный ритм |
| **Тип** | Временной |
| **Формат** | float (часы) |
| **Источник** | Вычисляется из IND.1.3.4, IND.1.5.1 |
| **Для промптов** | Да |
| **Для квалификации** | Да |

## Описание

Сколько часов в среднем человек инвестирует в саморазвитие за неделю.
Вычисляется как сумма времени учебных сессий и помидорок за период,
делённая на количество недель.

## Пороги по ступеням

| Ступень | Порог | Период учёта |
|---------|-------|--------------|
| Случайный | < 0.5 ч/нед | 1 неделя |
| Практикующий | ≥ 4 ч/нед | 4 недели |
| Систематический | ≥ 6 ч/нед | 8 недель |
| Дисциплинированный | ≥ 8 ч/нед | 12 недель |
| Проактивный | ≥ 10 ч/нед | 24 недели |

## Формула расчёта

```
IND.2.1.1 = (Σ session.duration + Σ pomodoro.duration) / weeks_count
```

## Связи

- **Зависит от:** IND.1.3.4 (учебные сессии), IND.1.5.1 (помидорки)
- **Влияет на:** IND.2.4.2 (ступень Ученика), IND.2.1.6 (индекс регулярности)

## Использование

- **Проводник:** диагностика ступени, рекомендации по увеличению времени
- **Аналитика:** когортный анализ, прогноз перехода на ступень
- **Квалификация:** один из ключевых критериев присвоения ступени
```

### 3.3. Машиночитаемый реестр (registry.json)

```json
{
  "version": "0.2",
  "updated": "2026-02-01",
  "notation": {
    "primary": "IND.1.*",
    "derived": "IND.2.*"
  },
  "stages": [
    {"code": "STG.Student.Random", "name": "Случайный", "period_weeks": 1},
    {"code": "STG.Student.Practicing", "name": "Практикующий", "period_weeks": 4},
    {"code": "STG.Student.Systematic", "name": "Систематический", "period_weeks": 8},
    {"code": "STG.Student.Disciplined", "name": "Дисциплинированный", "period_weeks": 12},
    {"code": "STG.Student.Proactive", "name": "Проактивный", "period_weeks": 24}
  ],
  "groups": [
    {"code": "2.1", "name": "Агентность и учебный ритм", "path": "groups/2.1-agency.md"},
    {"code": "2.2", "name": "Степень мастерства", "path": "groups/2.2-mastery.md"},
    {"code": "2.3", "name": "Характеристики по ступеням", "path": "groups/2.3-characteristics.md"},
    {"code": "2.4", "name": "Квалификация", "path": "groups/2.4-qualification.md"},
    {"code": "2.5", "name": "Мастерство по ролям", "path": "groups/2.5-roles.md"},
    {"code": "2.6", "name": "Ресурсность и устойчивость", "path": "groups/2.6-resourcefulness.md"},
    {"code": "2.7", "name": "Сообщество и вклад", "path": "groups/2.7-community.md"},
    {"code": "2.10", "name": "Интегральные профили", "path": "groups/2.10-profiles.md"}
  ],
  "indicators": [
    {
      "code": "IND.2.1.1",
      "name": "Среднее число часов в неделю",
      "group": "2.1",
      "type": "temporal",
      "format": "float",
      "unit": "hours/week",
      "path": "indicators/derived/IND.2.1.1.md",
      "for_prompts": true,
      "for_qualification": true,
      "thresholds": {
        "STG.Student.Random": {"max": 0.5},
        "STG.Student.Practicing": {"min": 4},
        "STG.Student.Systematic": {"min": 6},
        "STG.Student.Disciplined": {"min": 8},
        "STG.Student.Proactive": {"min": 10}
      }
    },
    {
      "code": "IND.2.1.2",
      "name": "Доля дней со слотом",
      "group": "2.1",
      "type": "frequency",
      "format": "float",
      "unit": "ratio",
      "path": "indicators/derived/IND.2.1.2.md",
      "for_prompts": true,
      "for_qualification": true,
      "thresholds": {
        "STG.Student.Random": {"max": 0.14},
        "STG.Student.Practicing": {"min": 0.43},
        "STG.Student.Systematic": {"min": 0.71},
        "STG.Student.Disciplined": {"min": 0.86},
        "STG.Student.Proactive": {"min": 0.95}
      }
    },
    {
      "code": "IND.2.4.2",
      "name": "Внутренняя ступень Ученика",
      "group": "2.4",
      "type": "categorical",
      "format": "enum",
      "enum_values": ["Случайный", "Практикующий", "Систематический", "Дисциплинированный", "Проактивный"],
      "path": "indicators/derived/IND.2.4.2.md",
      "for_prompts": true,
      "for_qualification": true
    },
    {
      "code": "IND.2.10.1",
      "name": "Профиль застревания",
      "group": "2.10",
      "type": "categorical",
      "format": "enum",
      "enum_values": ["Хаос", "Тупик", "Поворот"],
      "path": "indicators/derived/IND.2.10.1.md",
      "for_prompts": true,
      "for_qualification": false
    }
  ]
}
```

---

## 4. MCP-инструменты

### 4.1. Группа META — работа с мета-моделью

Инструменты для чтения структуры и описаний показателей.

#### `describe_indicator`

Возвращает полное описание показателя из мета-модели.

**JSON-схема входа:**
```json
{
  "tool": "describe_indicator",
  "input": {
    "code": "IND.2.1.1"
  }
}
```

**JSON-схема выхода:**
```json
{
  "code": "IND.2.1.1",
  "name": "Среднее число часов саморазвития в неделю",
  "group": "2.1 Агентность и учебный ритм",
  "type": "temporal",
  "format": "float",
  "unit": "hours/week",
  "description": "Сколько часов в среднем человек инвестирует в саморазвитие за неделю.",
  "for_prompts": true,
  "for_qualification": true,
  "thresholds": {
    "STG.Student.Random": {"max": 0.5},
    "STG.Student.Practicing": {"min": 4},
    "STG.Student.Systematic": {"min": 6},
    "STG.Student.Disciplined": {"min": 8},
    "STG.Student.Proactive": {"min": 10}
  },
  "depends_on": ["IND.1.3.4", "IND.1.5.1"],
  "affects": ["IND.2.4.2", "IND.2.1.6"]
}
```

---

#### `list_indicators`

Возвращает список показателей по фильтру.

**JSON-схема входа:**
```json
{
  "tool": "list_indicators",
  "input": {
    "group": "2.1",
    "for_qualification": true
  }
}
```

**JSON-схема выхода:**
```json
{
  "indicators": [
    {"code": "IND.2.1.1", "name": "Среднее число часов в неделю"},
    {"code": "IND.2.1.2", "name": "Доля дней со слотом"},
    {"code": "IND.2.1.6", "name": "Индекс регулярности"}
  ],
  "count": 3,
  "filter": {"group": "2.1", "for_qualification": true}
}
```

---

#### `get_stage_thresholds`

Возвращает пороги показателей для конкретной ступени.

**JSON-схема входа:**
```json
{
  "tool": "get_stage_thresholds",
  "input": {
    "stage": "STG.Student.Systematic"
  }
}
```

**JSON-схема выхода:**
```json
{
  "stage": "STG.Student.Systematic",
  "name": "Систематический",
  "period_weeks": 8,
  "thresholds": [
    {"code": "IND.2.1.1", "name": "Часы в неделю", "min": 6},
    {"code": "IND.2.1.2", "name": "Доля дней со слотом", "min": 0.71},
    {"code": "IND.2.2.1", "name": "Интенсивность практики", "min": 3}
  ],
  "description": "Систематический ученик поддерживает стабильный ритм на протяжении 8 недель..."
}
```

---

#### `validate_value`

Проверяет значение на соответствие формату и порогам.

**JSON-схема входа:**
```json
{
  "tool": "validate_value",
  "input": {
    "code": "IND.2.1.1",
    "value": 5.5,
    "target_stage": "STG.Student.Systematic"
  }
}
```

**JSON-схема выхода:**
```json
{
  "valid": true,
  "code": "IND.2.1.1",
  "value": 5.5,
  "format_ok": true,
  "threshold_check": {
    "target_stage": "STG.Student.Systematic",
    "required_min": 6,
    "meets_threshold": false,
    "gap": 0.5,
    "message": "Не хватает 0.5 часов для Систематического"
  }
}
```

---

### 4.2. Группа DATA — работа с данными

Инструменты для чтения/записи данных конкретного человека.
Эти tools расширяют существующий [[MCP-сервер цифрового двойника 3.2]].

#### `read_indicator`

Читает значение показателя для человека.

**JSON-схема входа:**
```json
{
  "tool": "read_indicator",
  "input": {
    "code": "IND.2.1.1",
    "period": "4_weeks"
  }
}
```

**JSON-схема выхода:**
```json
{
  "code": "IND.2.1.1",
  "name": "Среднее число часов в неделю",
  "value": 5.2,
  "unit": "hours/week",
  "period": {
    "weeks": 4,
    "start": "2026-01-04",
    "end": "2026-02-01"
  },
  "stage_context": {
    "current_stage": "Практикующий",
    "threshold_for_next": 6,
    "gap": 0.8
  }
}
```

---

#### `write_indicator`

Записывает значение показателя (для настраиваемых параметров).

**JSON-схема входа:**
```json
{
  "tool": "write_indicator",
  "input": {
    "code": "IND.1.PREF.daily_task_time",
    "value": "08:30"
  }
}
```

**JSON-схема выхода:**
```json
{
  "success": true,
  "code": "IND.1.PREF.daily_task_time",
  "previous": "08:00",
  "new_value": "08:30",
  "updated_at": "2026-02-01T10:30:00Z"
}
```

---

#### `get_person_context`

Возвращает контекст человека для промптов (все показатели с `for_prompts: true`).

**JSON-схема входа:**
```json
{
  "tool": "get_person_context",
  "input": {}
}
```

**JSON-схема выхода:**
```json
{
  "person_id": "user_123",
  "stage": {
    "current": "Практикующий",
    "since": "2026-01-15",
    "next_target": "Систематический"
  },
  "metrics": {
    "IND.2.1.1": {"value": 5.2, "name": "Часы в неделю"},
    "IND.2.1.2": {"value": 0.57, "name": "Доля дней со слотом"},
    "IND.2.2.1": {"value": 2.5, "name": "Интенсивность практики"}
  },
  "preferences": {
    "daily_task_time": "08:00",
    "weekly_analytics_day": "sunday"
  },
  "stagnation_profile": "Тупик",
  "period": "4_weeks"
}
```

---

## 5. Связь с существующими документами

### 5.1. Отношение к Модели данных цифрового двойника 3.2

| Аспект | Модель данных 3.2 | Мета-модель (этот документ) |
|--------|-------------------|----------------------------|
| **Что описывает** | Какие показатели существуют | Как описаны показатели |
| **Формат** | Таблицы с перечнем | Markdown + JSON с деталями |
| **Пороги** | Упомянуты в тексте | Структурированы машиночитаемо |
| **Использование** | Понимание структуры | Валидация, автоматизация |

**Мета-модель НЕ заменяет, а дополняет** существующую модель данных.

### 5.2. Отношение к MCP-серверу цифрового двойника 3.2

Существующий MCP-сервер содержит tools группы DATA:
- `get_learner_summary`
- `get_learner_core_metrics`
- `upsert_learner_stage_evaluation`
- и другие

Мета-модель добавляет tools группы META:
- `describe_indicator`
- `list_indicators`
- `get_stage_thresholds`
- `validate_value`

Оба набора tools работают в одном MCP-сервере.

### 5.3. Маппинг показателей из таблицы стажёра

| Показатель из таблицы | Код в мета-модели | Группа |
|-----------------------|-------------------|--------|
| Регулярность саморазвития | IND.2.1.2 | 2.1 Агентность |
| Устойчивость слотов | IND.2.1.4 | 2.1 Агентность |
| Частота рефлексий | IND.2.3.2 | 2.3 Характеристики |
| Инвестированное время | IND.2.1.1 | 2.1 Агентность |
| Ступень квалификации | IND.2.4.2 | 2.4 Квалификация |
| Профиль застревания | IND.2.10.1 | 2.10 Профили |
| Время получения задания | IND.1.PREF.daily_task_time | 1.PREF Настройки |
| Текущие роли | IND.1.PREF.role_set | 1.PREF Настройки |

---

## 6. Расширение мета-модели

### 6.1. Процесс добавления показателя

1. **Определить код** по существующей нотации:
   - `IND.1.X.Y` — первичные данные
   - `IND.2.X.Y` — производные показатели
   - `IND.1.PREF.*` — настраиваемые предпочтения

2. **Создать файл описания** в `indicators/`

3. **Добавить в registry.json**

4. **Обновить MCP-сервер** (если нужна специальная логика)

5. **Проверить CI/CD** — валидация схемы

### 6.2. Версионирование

- **Мажорная версия:** изменение структуры групп, удаление показателей
- **Минорная версия:** добавление новых показателей
- **Патч:** уточнение описаний, исправление ошибок

Текущая версия мета-модели: **0.2.0**

---

## 7. Открытые вопросы

1. **Размещение мета-модели:** Создать `0.OPS/0.x.Metamodel/` или разместить в другом месте?
2. **Синхронизация:** Как синхронизировать registry.json с существующей Моделью данных 3.2?
3. **Расширение IND.1.PREF:** Какие настраиваемые предпочтения добавить (role_set, domain_focus, daily_task_time)?
4. **Права доступа:** Кто может редактировать мета-модель (методологи) vs данные (системы)?

---

## См. также

- [[C2.2.Architecture/3.2.3.1. Цифровой двойник/Модель данных цифрового двойника 3.2.md]] — базовая модель данных
- [[C2.2.Architecture/3.2.3.1. Цифровой двойник/MCP-сервер цифрового двойника 3.2.md]] — существующий MCP-сервер
- [[Концепция Проводника по персональному маршруту.md]] — использование данных в Проводнике
