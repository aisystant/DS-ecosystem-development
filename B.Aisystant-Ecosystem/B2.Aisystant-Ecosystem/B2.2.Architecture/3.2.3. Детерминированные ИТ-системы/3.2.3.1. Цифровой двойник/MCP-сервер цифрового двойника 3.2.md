---

title: MCP-сервер цифрового двойника
family: F8
cell: '3.2'
version: v3.0
status: active
date_created: '2025-12-09'
date_modified: '2026-02-05'
related:
- Модель данных цифрового двойника 3.2
- Описание цифрового двойника 3.2
- Описание ИИ-ассистента Проводник (Ассистент Ученика) 3.2
- Концепция Проводника (Ассистент Ученика) 3.2
description: 'Описание MCP-сервера над Моделью данных цифрового двойника: архитектура,
  tools, JSON-схемы, примеры использования для ИИ-Проводника'
type: doc
created: '2025-12-12'
layer: operations
scope: local-edge
aliases:
- MCP-сервер ЦД
- Digital Twin MCP Server
---

# MCP-сервер цифрового двойника 3.2

> **Репозиторий:** [github.com/aisystant/DS-twin](https://github.com/aisystant/DS-twin)

## Цель и назначение

MCP-сервер цифрового двойника — интерфейсный слой для работы ИИ-Проводника (`AGT.RouteGuide`) с данными участника экосистемы.

**Документ включает:**
- Архитектуру и развёртывание MCP-сервера
- Список MCP-tools (3 универсальных инструмента) с JSON-схемами
- Примеры использования
- Метамодель показателей

---

## Текущее развёртывание

### Продуктивная среда

| Компонент | URL / Идентификатор |
|-----------|---------------------|
| **GPT "Ассистент Ученика"** | https://chatgpt.com/g/g-6931986f5d6081918c133a667bb2d1d5-assistent-uchenika |
| **MCP-сервер** | https://DS-twin.aisystant.workers.dev/mcp |
| **Платформа хостинга** | Cloudflare Workers |
| **Протокол** | MCP (Model Context Protocol) |
| **Версия** | v1.0 |

### Хранилище данных

**Статус:** В процессе выбора

| Вариант | Статус | Примечание |
|---------|--------|------------|
| **Cloudflare KV/D1** | Тестируем | Текущий вариант для MVP |
| **PostgreSQL** | Рассматривается | Возможный вариант для production |
| **In-memory mock** | v1.0 | Для локальной разработки |

> **Примечание:** Хранилище ещё не выбрано окончательно. MVP работает на Cloudflare, далее может быть миграция на PostgreSQL или другое решение.

### Архитектура развёртывания

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ (Ученик)                        │
│         Общается через интерфейс ChatGPT / Telegram-бот         │
└─────────────────────────────┬───────────────────────────────────┘
                              │ HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│              ИИ-клиент (GPT / Claude / Бот)                     │
│  - Системный промпт с методикой ступеней                        │
│  - Подключён к MCP-серверу                                      │
│  - Вызывает tools для получения/записи данных                   │
└─────────────────────────────┬───────────────────────────────────┘
                              │ MCP Protocol
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│       MCP-сервер (Cloudflare Workers)                           │
│       https://DS-twin.aisystant.workers.dev/mcp        │
│                                                                  │
│  3 универсальных инструмента:                                   │
│  • describe_by_path  — структура метамодели                     │
│  • read_digital_twin — чтение данных                            │
│  • write_digital_twin — запись данных                           │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│            Хранилище (в процессе выбора)                        │
│  - Cloudflare KV/D1 (текущий MVP)                               │
│  - PostgreSQL (рассматривается)                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## MCP-tools: 3 универсальных инструмента

### Философия архитектуры

**Было (v0.x):** 13+ специализированных инструментов (get_learner_summary, get_stage_history, upsert_learning_route, ...)

**Стало (v1.0):** 3 универсальных инструмента, работающих с метамоделью через пути.

**Преимущества:**
- Метамодель в MD-файлах, а не захардкожена в коде
- Гибкость: новые показатели добавляются без изменения API
- Простота: один инструмент для всех операций чтения, один для записи

---

### Tool 1: `describe_by_path`

**Назначение:** Описание структуры метамодели цифрового двойника.

**Когда использовать:** Чтобы понять, какие данные доступны по определённому пути.

**JSON-схема входа:**
```json
{
  "tool": "describe_by_path",
  "input": {
    "path": "agency"
  }
}
```

**Примеры путей:**
- `""` или `/` — корень метамодели (все группы)
- `"agency"` — группа показателей агентности
- `"agency.hours_per_week"` — конкретный показатель
- `"stages"` — ступени Ученика
- `"qualification"` — квалификации

**JSON-схема выхода:**
```json
{
  "path": "agency",
  "description": "Показатели агентности и учебного ритма",
  "children": [
    {
      "name": "hours_per_week",
      "type": "number",
      "description": "Среднее число часов саморазвития в неделю"
    },
    {
      "name": "regularity",
      "type": "number",
      "description": "Доля дней со слотом (регулярность)"
    },
    {
      "name": "slot_stability",
      "type": "number",
      "description": "Стабильность слотов (серии дней подряд)"
    }
  ]
}
```

---

### Tool 2: `read_digital_twin`

**Назначение:** Чтение данных из цифрового двойника по пути.

**Когда использовать:** Для получения текущих значений показателей, истории, маршрутов.

**JSON-схема входа:**
```json
{
  "tool": "read_digital_twin",
  "input": {
    "path": "agency.hours_per_week"
  }
}
```

**Поддержка точечной нотации и слэшей:**
- `"agency.hours_per_week"` — точечная нотация
- `"agency/hours_per_week"` — слэш-нотация (эквивалентно)

**Примеры чтения:**

| Путь | Что возвращает |
|------|----------------|
| `"agency"` | Все показатели агентности |
| `"agency.hours_per_week"` | Текущее значение часов/неделю |
| `"stages.current"` | Текущая ступень Ученика |
| `"stages.history"` | История смены ступеней |
| `"mastery"` | Показатели мастерства |
| `"integral.stagnation_profile"` | Профиль застревания |

**JSON-схема выхода:**
```json
{
  "path": "agency.hours_per_week",
  "value": 4.5,
  "metadata": {
    "last_updated": "2026-02-01T10:00:00Z",
    "period": "4_weeks"
  }
}
```

---

### Tool 3: `write_digital_twin`

**Назначение:** Запись данных в цифровой двойник по пути.

**Когда использовать:** Для обновления оценок, записи сессий, изменения маршрутов.

**JSON-схема входа:**
```json
{
  "tool": "write_digital_twin",
  "input": {
    "path": "stages.current",
    "value": {
      "stage": "Практикующий",
      "reason": "Ежедневный слот 20+ минут стабильно 2 недели",
      "confidence": 0.85,
      "evaluated_at": "2026-02-05T10:00:00Z"
    }
  }
}
```

**Примеры записи:**

| Путь | Что записывается |
|------|------------------|
| `"stages.current"` | Новая оценка ступени |
| `"routes.current"` | Новый или обновлённый маршрут |
| `"sessions"` | Лог сессии Проводника |
| `"agency.hours_per_week"` | Пересчитанное значение |

**JSON-схема выхода:**
```json
{
  "success": true,
  "path": "stages.current",
  "operation": "updated",
  "timestamp": "2026-02-05T10:00:00Z"
}
```

---

## Метамодель: 11 групп показателей

Метамодель хранится в MD-файлах в директории `/metamodel/` репозитория.

```
metamodel/
├── 01_preferences/     # Предпочтения
├── 02_agency/          # Агентность (часы, регулярность, слоты)
├── 03_mastery/         # Мастерство (практика, прогресс)
├── 04_characteristics/ # Характеристики
├── 05_qualification/   # Квалификации
├── 06_roles/           # Роли (Ученик, Интеллектуал, ...)
├── 07_resourcefulness/ # Ресурсность
├── 08_community/       # Сообщество (клуб, посты)
├── 09_economics/       # Экономика (токены, подписки)
├── 10_ai_usage/        # Использование ИИ
├── 11_integral/        # Интегральные (застревание, риски)
├── degrees.md          # Уровни квалификации
└── stages.md           # Ступени Ученика
```

### Ступени Ученика (stages.md)

| Ступень | Код | Критерии |
|---------|-----|----------|
| **Случайный** | Random | Нет устойчивого ритма, < 0.5 ч/нед |
| **Практикующий** | Practicing | 15+ мин/день, 4+ часа/неделю |
| **Систематический** | Systematic | 6+ ч/нед, 8+ недель подряд |
| **Дисциплинированный** | Disciplined | 8+ ч/нед, 12+ недель |
| **Проактивный** | Proactive | 10+ ч/нед, 24+ недели, самоуправление |

### Ключевые показатели агентности (02_agency/)

| Показатель | Файл | Описание |
|------------|------|----------|
| IND.2.1.1 | `01_Среднее число часов...` | Часы саморазвития в неделю |
| IND.2.1.2 | `02_Доля дней со слотом...` | Регулярность (0-1) |
| IND.2.1.3 | `03_Стабильность слотов...` | Серии дней подряд |
| IND.2.1.4 | `04_Частота срывов...` | Пропущенные слоты |
| IND.2.1.5 | `05_Индекс инициативности...` | Частота стратегирования |

---

## Примеры использования Проводником

### Сценарий 1: Первичная диагностика

```
1. describe_by_path(path="")              → понять структуру
2. read_digital_twin(path="agency")       → текущие показатели
3. read_digital_twin(path="stages")       → история ступеней
4. write_digital_twin(path="stages.current", value={stage: "Случайный", ...})
5. write_digital_twin(path="sessions", value={type: "initial", ...})
```

### Сценарий 2: Еженедельная сессия

```
1. read_digital_twin(path="sessions")     → контекст прошлых сессий
2. read_digital_twin(path="agency")       → показатели за неделю
3. read_digital_twin(path="routes.current") → текущий маршрут
4. [Диалог с пользователем]
5. write_digital_twin(path="routes.current", value={...}) → обновление
6. write_digital_twin(path="sessions", value={type: "weekly", ...})
```

### Сценарий 3: Переход на следующую ступень

```
1. read_digital_twin(path="stages.history")
2. read_digital_twin(path="agency")
3. read_digital_twin(path="mastery")
4. [Проверка критериев перехода]
5. write_digital_twin(path="stages.current", value={stage: "Практикующий", ...})
6. write_digital_twin(path="sessions", value={type: "transition", ...})
```

---

## Режимы развёртывания

### 1. Локальный (stdio)

Для разработки и тестирования с Claude Desktop или другими MCP-клиентами.

```bash
npm install
npm run dev
```

Подключение в Claude Desktop (`~/.config/claude/claude.json`):
```json
{
  "mcpServers": {
    "digital-twin": {
      "command": "node",
      "args": ["/path/to/DS-twin/src/index.js"]
    }
  }
}
```

### 2. HTTP API (Cloudflare Workers)

Для production и интеграции с GPT/ботами.

```bash
npm run deploy
```

URL: `https://DS-twin.aisystant.workers.dev/mcp`

---

## Связанные документы

- [[Модель данных цифрового двойника 3.2]] — детальное описание показателей
- [[Описание цифрового двойника 3.2]] — обзор подсистемы
- [[Описание ИИ-ассистента Проводник (Ассистент Ученика) 3.2]] — описание ИИ-Проводника

---

## Changelog / История версий

| Дата | Версия | Автор | Изменения |
|------|--------|-------|-----------|
| 2026-02-05 | v3.0 | Claude | **Полная переработка под актуальную архитектуру.** 13 инструментов → 3 универсальных (describe_by_path, read_digital_twin, write_digital_twin). Метамодель в MD-файлах. Хранилище: в процессе выбора (Cloudflare / PostgreSQL). Добавлена ссылка на репозиторий. |
| 2025-12-20 | v2.0 | — | Добавлен раздел "Текущее развёртывание", JSON-схемы для 13 tools |
| 2025-12-09 | v1.0 | — | Создан документ |
